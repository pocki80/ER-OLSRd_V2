#!/bin/sh
#postinstall

olsrd2dir="/config/olsrd2/"
log="/var/log/0xffolsrd2.log"

# chmod olsrd2 binary
chmod 755 $olsrd2dir""olsrd2
chmod 755 $olsrd2dir""startolsrd2.sh

# establish default config file if config not already there
file="olsrd2.conf"
if [ ! -f $olsrd2dir$file ] && [ -f $olsrd2dir"olsrd2_default.conf" ]; then
    cp $olsrd2dir"olsrd2_default.conf" $olsrd2dir$file >>$log 2>>$log
fi

# fire up olsrd2 daemon
if [ -f $olsrd2dir"olsrd2.conf" ]; then
    $olsrd2dir""olsrd2 -l $olsrd2dir"olsrd2.conf" >>$log 2>>$log
    cp $olsrd2dir""startolsrd2.sh /config/scripts/post-config.d/startolsrd2.sh
else
    echo "daemon not started due to missing olsrd2.conf file" >>$log
fi

exit 0
